@page "/servers"
@using Discord.WebSocket
@using Microsoft.AspNetCore.Components.Authorization
@inject DiscordSocketClient DiscordClient
@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthenticationStateProvider

<AuthorizeView>
    <Authorized>
        <!-- User Header with Logout -->
        <div class="flex justify-between items-center px-6 mb-8 mt-4">
            <div class="flex items-center gap-3">
                <img alt="Profile" class="w-10 h-10 rounded-full border-2 border-white dark:border-surface-dark shadow-sm" 
                     src="@context.User.FindFirst("urn:discord:avatar")?.Value" />
                <div>
                    <h1 class="font-bold leading-tight">@context.User.Identity?.Name</h1>
                    <p class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">Bot Admin</p>
                </div>
            </div>
            <a href="logout" class="p-2 rounded-full bg-red-50 text-red-500 hover:bg-red-100 transition-colors">
                <span class="material-icons-round">logout</span>
            </a>
        </div>

        <div class="px-6 mb-8">
            <h2 class="text-2xl font-bold tracking-tight">Your Servers</h2>
            <p class="text-xs text-gray-500">Select a server to manage</p>
        </div>

        <div class="px-6 space-y-4">
            @foreach (var guild in DiscordClient.Guilds.OrderByDescending(g => g.MemberCount))
            {
                <a href="/server/@guild.Id" class="glass rounded-3xl p-5 hover:border-primary/40 hover:scale-[1.02] transition-all cursor-pointer group block">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            @if (!string.IsNullOrEmpty(guild.IconUrl))
                            {
                                <img src="@guild.IconUrl" class="w-12 h-12 rounded-2xl shadow-sm group-hover:shadow-md transition-shadow" alt="@guild.Name" />
                            }
                            else
                            {
                                <div class="w-12 h-12 rounded-2xl bg-primary/10 flex items-center justify-center text-primary font-bold">
                                    @guild.Name[0]
                                </div>
                            }
                            <div>
                                <h3 class="font-bold group-hover:text-primary transition-colors text-gray-800 dark:text-white">@guild.Name</h3>
                                <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">@guild.MemberCount Members</p>
                            </div>
                        </div>
                        <span class="material-icons-round text-gray-300 group-hover:text-primary group-hover:translate-x-1 transition-all">chevron_right</span>
                    </div>
                </a>
            }
        </div>
    </Authorized>
    <NotAuthorized>
        @{ Navigation.NavigateTo("/"); }
    </NotAuthorized>
</AuthorizeView>

@code {
    // NavigateToDashboard method is no longer needed as we use <a> tags
}