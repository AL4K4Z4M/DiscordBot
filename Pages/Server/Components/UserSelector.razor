@using Discord.WebSocket
@inject DiscordSocketClient DiscordClient

<div class="space-y-4">
    <div class="relative">
        <input type="text" @bind="searchQuery" @bind:event="oninput" placeholder="Search members..." 
               class="w-full bg-white/50 dark:bg-black/20 border border-gray-200 dark:border-white/10 rounded-xl p-3 pl-10 text-sm focus:ring-2 focus:ring-primary outline-none transition-all" />
        <span class="material-icons-round absolute left-3 top-3 text-gray-400">search</span>
    </div>

    <div class="max-h-64 overflow-y-auto hide-scroll space-y-2">
        @foreach (var user in FilteredUsers)
        {
            <div class="flex items-center gap-3 p-2 rounded-xl hover:bg-primary/10 cursor-pointer transition-colors"
                 @onclick="() => OnUserSelected.InvokeAsync(user)">
                <img src="@(user.GetAvatarUrl() ?? user.GetDefaultAvatarUrl())" class="w-10 h-10 rounded-full" />
                <div>
                    <div class="font-bold text-sm">@user.Username</div>
                    <div class="text-xs text-gray-500">@user.Nickname</div>
                </div>
            </div>
        }
        @if (!FilteredUsers.Any())
        {
            <div class="text-center text-gray-400 text-xs py-4">No members found.</div>
        }
    </div>
</div>

@code {
    [Parameter] public SocketGuild Guild { get; set; } = default!;
    [Parameter] public EventCallback<SocketGuildUser> OnUserSelected { get; set; }

    private string searchQuery = "";

    private IEnumerable<SocketGuildUser> FilteredUsers => 
        string.IsNullOrWhiteSpace(searchQuery) 
            ? Guild.Users.Take(10) 
            : Guild.Users.Where(u => u.Username.Contains(searchQuery, StringComparison.OrdinalIgnoreCase) || 
                                     (u.Nickname != null && u.Nickname.Contains(searchQuery, StringComparison.OrdinalIgnoreCase)))
                         .Take(10);
}
